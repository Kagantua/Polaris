# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "name": "宝塔数据库未授权访问漏洞",
        "description": "宝塔Linx面板是提升运维效率的服务器管理软件。宝塔数据库phpmyadmin存在未授权访问漏洞，攻击者可利用该漏洞未授权进入数据库修改信息",
        "references": ["https://www.cnvd.org.cn/flaw/show/CNVD-2021-14826"],
    }

    def __condition__(self):
        return self.condition(
            matches=[
                {
                    "search": "body",
                    "keyword": ["站点创建成功", "bt.cn"]
                },
                {
                    "search": "body",
                    "keyword": ["站点创建成功", "宝塔"]
                },
                {
                    "search": "body",
                    "keyword": ["扫码登录更安全", "bt.cn", "/login"]
                },
                {
                    "search": "body",
                    "keyword": ["<title>恭喜，站点创建成功", "面板系统后台", "系统自动生成"]
                }
            ]
        )

    def url(self) -> dict:
        r = self.request(
            method='get',
            url=f'{self.target.value}:888/pma',
            timeout=15
        )
        if r.status_code == 200:
            return {"LoopholeInfo": self.__info__}
